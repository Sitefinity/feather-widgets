!function(r){"use strict";function t(t){this.rootUrl=t&&"/"!==t[t.length-1]?t+"/":t}t.prototype={makeAjax:function(t,a,e){var i={type:a||"GET",url:t,contentType:"application/json",accepts:{text:"application/json"},cache:!1};return e&&(i.data=JSON.stringify(e)),r.ajax(i)},getCaptcha:function(){var t=this.rootUrl;return this.makeAjax(t)},validateCaptcha:function(t){var a=this.rootUrl;return this.makeAjax(a,"POST",t)}};function n(t,a,e){this.wrapper=t,this.settings=a,this.resources=e}function e(t){var a=r(t).parents('[data-sf-role="field-captcha-container"]'),e=r(a).find('[data-sf-role="violation-messages"]');return JSON.parse(e.val())}function i(t,a){var e=c(t);e?function(t,a){""===(t.innerText=a)?t.style.display="none":t.style.display="block"}(e,a):t.setCustomValidity(a)}function c(t){var a=r(t).closest('[data-sf-role="field-captcha-container"]')[0];return a?a.querySelector('[data-sf-role="error-message"]'):null}function s(t){if(void 0!==t.target.validity){if(t.target.required&&t.target.validity.valueMissing){var a=e(t.target);i(t.target,a.required)}else i(t.target,"");c(t.target)||t.data.hideInvalidMessage()}}function o(t){if(void 0!==t.target.validity){c(t.target)&&t.preventDefault();var a=e(t.target);t.target.validity.valueMissing&&i(t.target,a.required)}}n.prototype={getOrInitializeProperty:function(t,a){return this[t]||(this[t]=this.getElementByDataSfRole(a)),this[t]},getElementByDataSfRole:function(t){return this.wrapper.find('[data-sf-role="'+t+'"]')},captchaImage:function(){return this.getOrInitializeProperty("_captchaImage","captcha-image")},captchaAudio:function(){return this.getOrInitializeProperty("_captchaAudio","captcha-audio")},captchaAudioBtn:function(){return this.getOrInitializeProperty("_captchaAudioBtn","captcha-audio-btn")},captchaInput:function(){return this.getOrInitializeProperty("_captchaInput","captcha-input")},captchaRefreshLink:function(){return this.getOrInitializeProperty("_captchaRefreshLink","captcha-refresh-button")},captchaDataKey:function(){return this.getOrInitializeProperty("_captchaDataKey","captcha-k")},captchaDataInvalidAnswerMessage:function(){return this.getOrInitializeProperty("_captchaDataInvalidAnswerMessage","captcha-iam")},errorMessage:function(){return this.getOrInitializeProperty("_errorMessage","error-message")},captchaRefresh:function(){var a=this,e=r.Deferred();return a.captchaImage().attr("src",""),a.captchaInput().hide(),a.restApi.getCaptcha().then(function(t){t&&(a.captchaImage().attr("src","data:image/png;base64,"+t.Image),a.captchaAudio().attr("src","data:audio/wav;base64,"+t.Audio),a.captchaAudioBtn().click(function(){a.captchaAudio()[0].play()}),a.captchaDataKey().val(t.Key),a.captchaInput().val(""),a.captchaInput().show(),a.wrapper.show()),e.resolve(!0)}),e},validateInput:function(){var a=this,e=r.Deferred(),t={Answer:a.captchaInput().val(),Key:a.captchaDataKey().val()};return a.restApi.validateCaptcha(t).then(function(t){t.IsValid?a.hideInvalidMessage():(a.showInvalidMessage(),t.RefreshCaptcha?a.captchaRefresh():(a.wrapper.find("input").focus(),a.wrapper.find("input").select())),e.resolve(t.IsValid)}),e},initializeProperties:function(){this.restApi=new t(this.settings.rootUrl),this.captchaData={key:null}},initializeCaptcha:function(){this.captchaRefresh()},initializeHandlers:function(){var t=this;t.captchaRefreshLink().click(function(){return t.captchaRefresh(),!1})},showInvalidMessage:function(){if(0<this.errorMessage().length){var t=this.captchaDataInvalidAnswerMessage().val();this.errorMessage().text(t),this.errorMessage().show()}else this.getElementByDataSfRole("invalid-captcha-input").css("visibility","visible")},hideInvalidMessage:function(){0<this.errorMessage().length?this.errorMessage().hide():this.getElementByDataSfRole("invalid-captcha-input").css("visibility","hidden")},initialize:function(){this.initializeProperties(),this.initializeCaptcha(),this.initializeHandlers(),this.hideInvalidMessage()}},r(function(){r('[data-sf-role="field-captcha-container"]').each(function(){var t=r(this),a=t.find('[data-sf-role="captcha-settings"]').val(),e=new n(t,{rootUrl:a});e.initialize();var i=t.find('[data-sf-role="captcha-input"]');i&&(i.on("change",e,s),i.on("input",e,s),i.on("invalid",o),i.data("widget-validator",function(){return e.validateInput()}))})})}(jQuery);
//# sourceMappingURL=captcha.min.js.map